[04-Jan-2026 15:56:29 UTC] User authenticated via JWT - User ID: 3
[04-Jan-2026 15:56:29 UTC] Checking order for logged-in user - Order ID: 17, User ID: 3
[04-Jan-2026 15:56:29 UTC] Order found successfully - Order ID: 17, Status: pending
[04-Jan-2026 15:56:31 UTC] === ZARINPAL API RESPONSE ===
[04-Jan-2026 15:56:31 UTC] HTTP Status: 401
[04-Jan-2026 15:56:31 UTC] Response: {"data":[],"errors":{"message":"To many attempts, please try again later.","code":-12,"validations":[]}}
[04-Jan-2026 15:56:31 UTC] =================================
[05-Jan-2026 14:16:04 UTC] User authenticated via JWT - User ID: 3
[05-Jan-2026 14:16:04 UTC] Checking order for logged-in user - Order ID: 18, User ID: 3
[05-Jan-2026 14:16:04 UTC] Order found successfully - Order ID: 18, Status: pending
[05-Jan-2026 14:16:06 UTC] === ZARINPAL API RESPONSE ===
[05-Jan-2026 14:16:06 UTC] HTTP Status: 200
[05-Jan-2026 14:16:06 UTC] Response: {"data":{"authority":"S000000000000000000000000000000vlgg3","fee":150000,"fee_type":"Merchant","code":100,"message":"Success"},"errors":[]}
[05-Jan-2026 14:16:06 UTC] =================================
[05-Jan-2026 14:16:06 UTC] === AUTHORITY RECEIVED FROM ZARINPAL ===
[05-Jan-2026 14:16:06 UTC] Authority: S000000000000000000000000000000vlgg3
[05-Jan-2026 14:16:06 UTC] Authority type: string
[05-Jan-2026 14:16:06 UTC] Authority length: 36
[05-Jan-2026 14:16:06 UTC] Authority trimmed: S000000000000000000000000000000vlgg3
[05-Jan-2026 14:16:06 UTC] Full resultData['data']: {"authority":"S000000000000000000000000000000vlgg3","fee":150000,"fee_type":"Merchant","code":100,"message":"Success"}
[05-Jan-2026 14:16:06 UTC] =========================================
[05-Jan-2026 14:16:06 UTC] === AUTHORITY NORMALIZATION ===
[05-Jan-2026 14:16:06 UTC] Original authority (raw): 'S000000000000000000000000000000vlgg3'
[05-Jan-2026 14:16:06 UTC] Original authority length: 36
[05-Jan-2026 14:16:06 UTC] Original authority hex: 53303030303030303030303030303030303030303030303030303030303030766c676733
[05-Jan-2026 14:16:06 UTC] After whitespace removal: 'S000000000000000000000000000000vlgg3' (length: 36)
[05-Jan-2026 14:16:06 UTC] After non-printable removal: 'S000000000000000000000000000000vlgg3' (length: 36)
[05-Jan-2026 14:16:06 UTC] After alphanumeric filter: 'S000000000000000000000000000000vlgg3' (length: 36)
[05-Jan-2026 14:16:06 UTC] ✅ Authority from sandbox (full, for DB): S000000000000000000000000000000vlgg3 (length: 36)
[05-Jan-2026 14:16:06 UTC] ✅ Authority for URL (first 36 chars): S000000000000000000000000000000vlgg3
[05-Jan-2026 14:16:06 UTC] ✅ Original authority from sandbox: 'S000000000000000000000000000000vlgg3'
[05-Jan-2026 14:16:06 UTC] =========================================
[05-Jan-2026 14:16:06 UTC] === SAVING AUTHORITY TO DATABASE ===
[05-Jan-2026 14:16:06 UTC] Authority to save: S000000000000000000000000000000vlgg3
[05-Jan-2026 14:16:06 UTC] Authority length: 36
[05-Jan-2026 14:16:06 UTC] === INSERTING/UPDATING PAYMENT RECORD ===
[05-Jan-2026 14:16:06 UTC] Order ID: 18
[05-Jan-2026 14:16:06 UTC] Authority (from sandbox): S000000000000000000000000000000vlgg3
[05-Jan-2026 14:16:06 UTC] Authority length: 36
[05-Jan-2026 14:16:06 UTC] Amount: 14605416
[05-Jan-2026 14:16:06 UTC] User ID: 3
[05-Jan-2026 14:16:06 UTC] SQL Query: INSERT INTO payments (order_id, user_id, amount, authority, status, created_at) 
            VALUES (?, ?, ?, ?, 'pending', NOW())
            ON DUPLICATE KEY UPDATE 
                order_id = IF(order_id != VALUES(order_id), VALUES(order_id), order_id),
                user_id = IF(user_id = 0 AND VALUES(user_id) != 0, VALUES(user_id), user_id),
                amount = IF(amount != VALUES(amount), VALUES(amount), amount),
                authority = VALUES(authority)
[05-Jan-2026 14:16:06 UTC] SQL Params: order_id=18, user_id=3, amount=14605416, authority=S000000000000000000000000000000vlgg3
[05-Jan-2026 14:16:06 UTC] Executing INSERT with params: order_id=18, user_id=3, amount=14605416, authority=S000000000000000000000000000000vlgg3
[05-Jan-2026 14:16:06 UTC] ✅ New payment record inserted - Payment ID: 48
[05-Jan-2026 14:16:06 UTC] ✅ Payment verified in database:
[05-Jan-2026 14:16:06 UTC]   - ID: 48
[05-Jan-2026 14:16:06 UTC]   - Order ID: 18
[05-Jan-2026 14:16:06 UTC]   - Authority in DB: S000000000000000000000000000000vlgg3
[05-Jan-2026 14:16:06 UTC]   - Authority original: S000000000000000000000000000000vlgg3
[05-Jan-2026 14:16:06 UTC]   - Match: YES ✅
[05-Jan-2026 14:16:06 UTC]   - Amount: 14605416
[05-Jan-2026 14:16:06 UTC]   - Status: pending
[05-Jan-2026 14:16:06 UTC] === FINAL VERIFICATION ===
[05-Jan-2026 14:16:06 UTC] ✅ FINAL CHECK: Authority found in database!
[05-Jan-2026 14:16:06 UTC]   - Payment ID: 48
[05-Jan-2026 14:16:06 UTC]   - Authority: S000000000000000000000000000000vlgg3
[05-Jan-2026 14:16:06 UTC]   - Order ID: 18
[05-Jan-2026 14:16:06 UTC]   - Status: pending
[05-Jan-2026 14:16:06 UTC] ==========================
[05-Jan-2026 14:16:06 UTC] Payment URL created: https://sandbox.zarinpal.com/pg/StartPay/S000000000000000000000000000000vlgg3
[05-Jan-2026 14:16:06 UTC] Authority in URL (first 36 chars): S000000000000000000000000000000vlgg3 (length: 36)
[05-Jan-2026 14:16:06 UTC] Authority full (saved in DB): S000000000000000000000000000000vlgg3 (length: 36)
[05-Jan-2026 14:16:06 UTC] === FINAL RESPONSE ===
[05-Jan-2026 14:16:06 UTC] Payment URL: https://sandbox.zarinpal.com/pg/StartPay/S000000000000000000000000000000vlgg3
[05-Jan-2026 14:16:06 UTC] Authority for URL (first 36 chars): S000000000000000000000000000000vlgg3 (length: 36)
[05-Jan-2026 14:16:06 UTC] Authority full (saved in DB): S000000000000000000000000000000vlgg3 (length: 36)
[05-Jan-2026 14:16:06 UTC] Amount: 14605416
[05-Jan-2026 14:16:10 UTC] Payment callback received - Authority (raw): S000000000000000000000000000000vlgg3, Status: OK
[05-Jan-2026 14:16:10 UTC] All GET params: {"Authority":"S000000000000000000000000000000vlgg3","Status":"OK"}
[05-Jan-2026 14:16:10 UTC] Authority from callback (full): S000000000000000000000000000000vlgg3 (length: 36)
[05-Jan-2026 14:16:10 UTC] Authority from database (full): S000000000000000000000000000000vlgg3 (length: 36)
[05-Jan-2026 14:16:10 UTC] Authority from callback (full): S000000000000000000000000000000vlgg3 (length: 36)
[05-Jan-2026 14:16:10 UTC] ✅ Authority for verify (first 36 chars): S000000000000000000000000000000vlgg3 (length: 36)
[05-Jan-2026 14:16:10 UTC] ✅ Authority full in DB: S000000000000000000000000000000vlgg3 (length: 36)
[05-Jan-2026 14:16:10 UTC] Verify request data: {"merchant_id":"586a9cbf-3f4c-4e1f-847f-17ac2ddb8374","amount":14605416,"authority":"S000000000000000000000000000000vlgg3","currency":"IRT"}
[05-Jan-2026 14:16:11 UTC] Zarinpal verify response - HTTP: 200, Response: {"data":{"wages":null,"code":100,"message":"Paid","card_hash":"0866A6EAEA5CB085E4CF6EF19296BF19647552DD5F96F1E530DB3AE61837EFE7","card_pan":"999999******9999","ref_id":18472901,"fee_type":"Merchant","fee":150000,"shaparak_fee":1200,"order_id":null},"errors":[]}
[05-Jan-2026 14:16:11 UTC] Zarinpal verify request - Amount: 14605416, Currency: IRT, Authority: S000000000000000000000000000000vlgg3, Merchant: 586a9cbf-3f4c-4e1f-847f-17ac2ddb8374
[31-Jan-2026 14:27:24 UTC] User authenticated via JWT - User ID: 3
[31-Jan-2026 14:27:24 UTC] Checking order for logged-in user - Order ID: 19, User ID: 3
[31-Jan-2026 14:27:24 UTC] Order found successfully - Order ID: 19, Status: pending
[31-Jan-2026 14:27:40 UTC] === ZARINPAL API RESPONSE ===
[31-Jan-2026 14:27:40 UTC] HTTP Status: 504
[31-Jan-2026 14:27:40 UTC] Response: null
[31-Jan-2026 14:27:40 UTC] =================================
[31-Jan-2026 14:27:55 UTC] User authenticated via JWT - User ID: 3
[31-Jan-2026 14:27:55 UTC] Checking order for logged-in user - Order ID: 20, User ID: 3
[31-Jan-2026 14:27:55 UTC] Order found successfully - Order ID: 20, Status: pending
[31-Jan-2026 14:28:11 UTC] === ZARINPAL API RESPONSE ===
[31-Jan-2026 14:28:11 UTC] HTTP Status: 504
[31-Jan-2026 14:28:11 UTC] Response: null
[31-Jan-2026 14:28:11 UTC] =================================
[31-Jan-2026 14:46:13 UTC] User authenticated via JWT - User ID: 3
[31-Jan-2026 14:46:13 UTC] Checking order for logged-in user - Order ID: 21, User ID: 3
[31-Jan-2026 14:46:13 UTC] Order found successfully - Order ID: 21, Status: pending
[31-Jan-2026 14:46:14 UTC] === ZARINPAL API RESPONSE ===
[31-Jan-2026 14:46:14 UTC] HTTP Status: 200
[31-Jan-2026 14:46:14 UTC] Response: {"data":{"authority":"S000000000000000000000000000000yx2xm","fee":13663,"fee_type":"Merchant","code":100,"message":"Success"},"errors":[]}
[31-Jan-2026 14:46:14 UTC] =================================
[31-Jan-2026 14:46:14 UTC] === AUTHORITY RECEIVED FROM ZARINPAL ===
[31-Jan-2026 14:46:14 UTC] Authority: S000000000000000000000000000000yx2xm
[31-Jan-2026 14:46:14 UTC] Authority type: string
[31-Jan-2026 14:46:14 UTC] Authority length: 36
[31-Jan-2026 14:46:14 UTC] Authority trimmed: S000000000000000000000000000000yx2xm
[31-Jan-2026 14:46:14 UTC] Full resultData['data']: {"authority":"S000000000000000000000000000000yx2xm","fee":13663,"fee_type":"Merchant","code":100,"message":"Success"}
[31-Jan-2026 14:46:14 UTC] =========================================
[31-Jan-2026 14:46:14 UTC] === AUTHORITY NORMALIZATION ===
[31-Jan-2026 14:46:14 UTC] Original authority (raw): 'S000000000000000000000000000000yx2xm'
[31-Jan-2026 14:46:14 UTC] Original authority length: 36
[31-Jan-2026 14:46:14 UTC] Original authority hex: 53303030303030303030303030303030303030303030303030303030303030797832786d
[31-Jan-2026 14:46:14 UTC] After whitespace removal: 'S000000000000000000000000000000yx2xm' (length: 36)
[31-Jan-2026 14:46:14 UTC] After non-printable removal: 'S000000000000000000000000000000yx2xm' (length: 36)
[31-Jan-2026 14:46:14 UTC] After alphanumeric filter: 'S000000000000000000000000000000yx2xm' (length: 36)
[31-Jan-2026 14:46:14 UTC] ✅ Authority from sandbox (full, for DB): S000000000000000000000000000000yx2xm (length: 36)
[31-Jan-2026 14:46:14 UTC] ✅ Authority for URL (first 36 chars): S000000000000000000000000000000yx2xm
[31-Jan-2026 14:46:14 UTC] ✅ Original authority from sandbox: 'S000000000000000000000000000000yx2xm'
[31-Jan-2026 14:46:14 UTC] =========================================
[31-Jan-2026 14:46:14 UTC] === SAVING AUTHORITY TO DATABASE ===
[31-Jan-2026 14:46:14 UTC] Authority to save: S000000000000000000000000000000yx2xm
[31-Jan-2026 14:46:14 UTC] Authority length: 36
[31-Jan-2026 14:46:14 UTC] === INSERTING/UPDATING PAYMENT RECORD ===
[31-Jan-2026 14:46:14 UTC] Order ID: 21
[31-Jan-2026 14:46:14 UTC] Authority (from sandbox): S000000000000000000000000000000yx2xm
[31-Jan-2026 14:46:14 UTC] Authority length: 36
[31-Jan-2026 14:46:14 UTC] Amount: 45546
[31-Jan-2026 14:46:14 UTC] User ID: 3
[31-Jan-2026 14:46:14 UTC] SQL Query: INSERT INTO payments (order_id, user_id, amount, authority, status, created_at) 
            VALUES (?, ?, ?, ?, 'pending', NOW())
            ON DUPLICATE KEY UPDATE 
                order_id = IF(order_id != VALUES(order_id), VALUES(order_id), order_id),
                user_id = IF(user_id = 0 AND VALUES(user_id) != 0, VALUES(user_id), user_id),
                amount = IF(amount != VALUES(amount), VALUES(amount), amount),
                authority = VALUES(authority)
[31-Jan-2026 14:46:14 UTC] SQL Params: order_id=21, user_id=3, amount=45546, authority=S000000000000000000000000000000yx2xm
[31-Jan-2026 14:46:14 UTC] Executing INSERT with params: order_id=21, user_id=3, amount=45546, authority=S000000000000000000000000000000yx2xm
[31-Jan-2026 14:46:14 UTC] ✅ New payment record inserted - Payment ID: 49
[31-Jan-2026 14:46:14 UTC] ✅ Payment verified in database:
[31-Jan-2026 14:46:14 UTC]   - ID: 49
[31-Jan-2026 14:46:14 UTC]   - Order ID: 21
[31-Jan-2026 14:46:14 UTC]   - Authority in DB: S000000000000000000000000000000yx2xm
[31-Jan-2026 14:46:14 UTC]   - Authority original: S000000000000000000000000000000yx2xm
[31-Jan-2026 14:46:14 UTC]   - Match: YES ✅
[31-Jan-2026 14:46:14 UTC]   - Amount: 45546
[31-Jan-2026 14:46:14 UTC]   - Status: pending
[31-Jan-2026 14:46:14 UTC] === FINAL VERIFICATION ===
[31-Jan-2026 14:46:14 UTC] ✅ FINAL CHECK: Authority found in database!
[31-Jan-2026 14:46:14 UTC]   - Payment ID: 49
[31-Jan-2026 14:46:14 UTC]   - Authority: S000000000000000000000000000000yx2xm
[31-Jan-2026 14:46:14 UTC]   - Order ID: 21
[31-Jan-2026 14:46:14 UTC]   - Status: pending
[31-Jan-2026 14:46:14 UTC] ==========================
[31-Jan-2026 14:46:14 UTC] Payment URL created: https://sandbox.zarinpal.com/pg/StartPay/S000000000000000000000000000000yx2xm
[31-Jan-2026 14:46:14 UTC] Authority in URL (first 36 chars): S000000000000000000000000000000yx2xm (length: 36)
[31-Jan-2026 14:46:14 UTC] Authority full (saved in DB): S000000000000000000000000000000yx2xm (length: 36)
[31-Jan-2026 14:46:14 UTC] === FINAL RESPONSE ===
[31-Jan-2026 14:46:14 UTC] Payment URL: https://sandbox.zarinpal.com/pg/StartPay/S000000000000000000000000000000yx2xm
[31-Jan-2026 14:46:14 UTC] Authority for URL (first 36 chars): S000000000000000000000000000000yx2xm (length: 36)
[31-Jan-2026 14:46:14 UTC] Authority full (saved in DB): S000000000000000000000000000000yx2xm (length: 36)
[31-Jan-2026 14:46:14 UTC] Amount: 45546
[31-Jan-2026 14:47:41 UTC] Payment callback received - Authority (raw): S000000000000000000000000000000yx2xm, Status: OK
[31-Jan-2026 14:47:41 UTC] All GET params: {"Authority":"S000000000000000000000000000000yx2xm","Status":"OK"}
[31-Jan-2026 14:47:41 UTC] Authority from callback (full): S000000000000000000000000000000yx2xm (length: 36)
[31-Jan-2026 14:47:41 UTC] Authority from database (full): S000000000000000000000000000000yx2xm (length: 36)
[31-Jan-2026 14:47:41 UTC] Authority from callback (full): S000000000000000000000000000000yx2xm (length: 36)
[31-Jan-2026 14:47:41 UTC] ✅ Authority for verify (first 36 chars): S000000000000000000000000000000yx2xm (length: 36)
[31-Jan-2026 14:47:41 UTC] ✅ Authority full in DB: S000000000000000000000000000000yx2xm (length: 36)
[31-Jan-2026 14:47:41 UTC] Verify request data: {"merchant_id":"586a9cbf-3f4c-4e1f-847f-17ac2ddb8374","amount":45546,"authority":"S000000000000000000000000000000yx2xm","currency":"IRT"}
[31-Jan-2026 14:47:42 UTC] Zarinpal verify response - HTTP: 200, Response: {"data":{"wages":null,"code":100,"message":"Paid","card_hash":"0866A6EAEA5CB085E4CF6EF19296BF19647552DD5F96F1E530DB3AE61837EFE7","card_pan":"999999******9999","ref_id":20139701,"fee_type":"Merchant","fee":13663,"shaparak_fee":1200,"order_id":null},"errors":[]}
[31-Jan-2026 14:47:42 UTC] Zarinpal verify request - Amount: 45546, Currency: IRT, Authority: S000000000000000000000000000000yx2xm, Merchant: 586a9cbf-3f4c-4e1f-847f-17ac2ddb8374
